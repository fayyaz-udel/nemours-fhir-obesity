<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Nemours FHIR Obesity</title>
    <script src="https://cdn.jsdelivr.net/npm/fhirclient/build/fhir-client.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="\css\style.css">

</head>


<body>

<nav class="navbar bg-primary" style="margin-bottom: 2vh">
    <div class="container-fluid">
        <span class="navbar-brand mb-0 h1 text-white">Nemours FHIR Obesity</span>
    </div>
</nav>


<div class="container">


    <!--    <h4>Medications</h4>-->
    <!--    <div id="meds">Loading...</div>-->

    <!--    <h4>Conditions</h4>-->
    <!--    <div id="conds">Loading...</div>-->

    <div>
        <table>
            <tr>
                <td>Name</td>
                <td id="p_first_name"></td>
            </tr>

            <tr>
                <td>Name</td>
                <td id="p_last_name"></td>
            </tr>
            <tr>
                <td>DOB</td>
                <td id="p_dob"></td>
            </tr>
        </table>
    </div>


    <script type="text/javascript">
        FHIR.oauth2.ready().then(function (client) {
            client.patient.read().then(function (pt) {
                document.getElementById("p_first_name").innerHTML = pt.name[0];
                document.getElementById("p_last_name").innerHTML = pt.name[0].family;
                document.getElementById("p_dob").innerHTML = pt.birthDate;

            });


            // Get MedicationRequests for the selected patient
            client.request("/MedicationRequest?patient=" + client.patient.id, {
                resolveReferences: ["medicationReference"],
                graph: true,
            })

                // Reject if no MedicationRequests are found
                .then(function (data) {
                    if (!data.entry || !data.entry.length) {
                        throw new Error("No medications found for the selected patient");
                    }

                    return data.entry;
                })

                // Render the current patient's medications (or any error)
                .then(
                    function (meds) {
                        document.getElementById("meds").innerText = JSON.stringify(meds, null, 4);
                    },
                    function (error) {
                        document.getElementById("meds").innerText = error.stack;
                    });


            client.request("/Condition?patient=" + client.patient.id, {
                resolveReferences: ["conditionReference"],
                graph: true,
            })
                .then(function (data) {
                    if (!data.entry || !data.entry.length) {
                        throw new Error("No conditions found for the selected patient");
                    }

                    return data.entry;
                })

                .then(
                    function (conds) {
                        document.getElementById("conds").innerText = JSON.stringify(conds, null, 4);
                    },
                    function (error) {
                        document.getElementById("conds").innerText = error.stack;
                    });


        })
            .catch(console.error);
    </script>
</div>
</body>
</html>
